<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>第 2 章: 一等公民的函数 | JavaScript 函数式编程指南中文版</title>
    
    <meta name="description" content="">
    
    <link rel="preload" href="/mostly-adequate-guide-chinese/assets/css/0.styles.e373d42e.css" as="style"><link rel="preload" href="/mostly-adequate-guide-chinese/assets/js/app.e22f068f.js" as="script"><link rel="preload" href="/mostly-adequate-guide-chinese/assets/js/2.35b03a7f.js" as="script"><link rel="preload" href="/mostly-adequate-guide-chinese/assets/js/17.15cbb2bc.js" as="script"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/10.9ff47bf3.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/11.1613d626.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/12.5037078b.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/13.54fbdcfe.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/14.85525b84.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/15.b0675b5a.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/16.44cb92b7.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/18.9af46e61.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/19.8afc0231.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/3.c39a0118.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/4.47caff48.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/5.209b7f11.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/6.5b22d12f.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/7.9f81ff05.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/8.95229e13.js"><link rel="prefetch" href="/mostly-adequate-guide-chinese/assets/js/9.2faab3a0.js">
    <link rel="stylesheet" href="/mostly-adequate-guide-chinese/assets/css/0.styles.e373d42e.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JNFKK7VGLS"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-JNFKK7VGLS');
    </script>
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mostly-adequate-guide-chinese/" class="home-link router-link-active"><!----> <span class="site-name">JavaScript 函数式编程指南中文版</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/mostly-adequate-guide-chinese/ch1.html" class="sidebar-link">第 1 章：我们在做什么？</a></li><li><a href="/mostly-adequate-guide-chinese/ch2.html" aria-current="page" class="active sidebar-link">第 2 章: 一等公民的函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mostly-adequate-guide-chinese/ch2.html#快速概览" class="sidebar-link">快速概览</a></li><li class="sidebar-sub-header"><a href="/mostly-adequate-guide-chinese/ch2.html#为何钟爱一等公民" class="sidebar-link">为何钟爱一等公民？</a></li></ul></li><li><a href="/mostly-adequate-guide-chinese/ch3.html" class="sidebar-link">第 3 章：纯函数的好处</a></li><li><a href="/mostly-adequate-guide-chinese/ch4.html" class="sidebar-link">第 4 章: 柯里化（curry）</a></li><li><a href="/mostly-adequate-guide-chinese/ch5.html" class="sidebar-link">第 5 章: 代码组合（compose）</a></li><li><a href="/mostly-adequate-guide-chinese/ch6.html" class="sidebar-link">第 6 章: 示例应用</a></li><li><a href="/mostly-adequate-guide-chinese/ch7.html" class="sidebar-link">第 7 章: Hindley-Milner 类型签名</a></li><li><a href="/mostly-adequate-guide-chinese/ch8.html" class="sidebar-link">第 8 章: 特百惠</a></li><li><a href="/mostly-adequate-guide-chinese/ch9.html" class="sidebar-link">第 9 章: Monad</a></li><li><a href="/mostly-adequate-guide-chinese/ch10.html" class="sidebar-link">第 10 章：Applicative Functor</a></li><li><a href="/mostly-adequate-guide-chinese/ch11.html" class="sidebar-link">第 11 章：再转换一次，就很自然</a></li><li><a href="/mostly-adequate-guide-chinese/ch12.html" class="sidebar-link">第 12 章：遍历</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第-2-章-一等公民的函数"><a href="#第-2-章-一等公民的函数" class="header-anchor">#</a> 第 2 章: 一等公民的函数</h1> <h2 id="快速概览"><a href="#快速概览" class="header-anchor">#</a> 快速概览</h2> <p>当我们说函数是“一等公民”的时候，我们实际上说的是它们和其他对象都一样...所以就是普通公民（坐经济舱的人？）。函数真没什么特殊的，你可以像对待任何其他数据类型一样对待它们——把它们存在数组里，当作参数传递，赋值给变量...等等。</p> <p>这是 JavaScript 语言的基础概念，不过还是值得提一提的，因为在 Github 上随便一搜就能看到对这个概念的集体无视，或者也可能是无知。我们来看一个杜撰的例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">hi</span> <span class="token operator">=</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hi </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">greeting</span> <span class="token operator">=</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token function">hi</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这里 <code>greeting</code> 指向的那个把 <code>hi</code> 包了一层的包裹函数完全是多余的。为什么？因为 JavaScript 的函数是<em>可调用</em>的，当 <code>hi</code> 后面紧跟 <code>()</code> 的时候就会运行并返回一个值；如果没有 <code>()</code>，<code>hi</code> 就简单地返回存到这个变量里的函数。我们来确认一下：</p> <div class="language-js extra-class"><pre class="language-js"><code>hi<span class="token punctuation">;</span> <span class="token comment">// name =&gt; `Hi ${name}`</span>
<span class="token function">hi</span><span class="token punctuation">(</span><span class="token string">&quot;jonas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Hi jonas&quot;</span>
</code></pre></div><p><code>greeting</code> 只不过是转了个身然后以相同的参数调用了 <code>hi</code> 函数而已，因此我们可以这么写：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> greeting <span class="token operator">=</span> hi<span class="token punctuation">;</span>
<span class="token function">greeting</span><span class="token punctuation">(</span><span class="token string">&quot;times&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Hi times&quot;</span>
</code></pre></div><p>换句话说，<code>hi</code> 已经是个接受一个参数的函数了，为何要再定义一个额外的包裹函数，而它仅仅是用这个相同的参数调用 <code>hi</code>？完全没有道理。这就像在大夏天里穿上你最厚的大衣，只是为了跟热空气过不去，然后吃上个冰棍。真是脱裤子放屁多此一举。</p> <p>用一个函数把另一个函数包起来，目的仅仅是延迟执行，真的是非常糟糕的编程习惯。（稍后我将告诉你原因，跟可维护性密切相关。）</p> <p>充分理解这个问题对读懂本书后面的内容至关重要，所以我们再来看几个例子。以下代码都来自 npm 上的模块包：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 太傻了</span>
<span class="token keyword">const</span> <span class="token function-variable function">getServerStuff</span> <span class="token operator">=</span> <span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token function">ajaxCall</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 这才像样</span>
<span class="token keyword">const</span> getServerStuff <span class="token operator">=</span> ajaxCall<span class="token punctuation">;</span>
</code></pre></div><p>世界上到处都充斥着这样的垃圾 ajax 代码。以下是上述两种写法等价的原因：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 这行</span>
<span class="token function">ajaxCall</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 等价于这行</span>
<span class="token function">ajaxCall</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 那么，重构下 getServerStuff</span>
<span class="token keyword">const</span> <span class="token function-variable function">getServerStuff</span> <span class="token operator">=</span> <span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token function">ajaxCall</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...就等于</span>
<span class="token keyword">const</span> getServerStuff <span class="token operator">=</span> ajaxCall <span class="token comment">// &lt;-- 看，没有括号哦</span>
</code></pre></div><p>各位，以上才是写函数的正确方式。一会儿再告诉你为何我对此如此执着。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> BlogController <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">index</span><span class="token punctuation">(</span><span class="token parameter">posts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Views<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>posts<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">show</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Views<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Db<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>attrs<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">post<span class="token punctuation">,</span> attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Db<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>post<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Db<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这个可笑的控制器（controller）99% 的代码都是垃圾。我们可以把它重写成这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> BlogController <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> Views<span class="token punctuation">.</span>index<span class="token punctuation">,</span>
  <span class="token literal-property property">show</span><span class="token operator">:</span> Views<span class="token punctuation">.</span>show<span class="token punctuation">,</span>
  <span class="token literal-property property">create</span><span class="token operator">:</span> Db<span class="token punctuation">.</span>create<span class="token punctuation">,</span>
  <span class="token literal-property property">update</span><span class="token operator">:</span> Db<span class="token punctuation">.</span>update<span class="token punctuation">,</span>
  <span class="token literal-property property">destroy</span><span class="token operator">:</span> Db<span class="token punctuation">.</span>destroy<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>...或者直接全部删掉，因为它的作用仅仅就是把视图（Views）和数据库（Db）打包在一起而已。</p> <h2 id="为何钟爱一等公民"><a href="#为何钟爱一等公民" class="header-anchor">#</a> 为何钟爱一等公民？</h2> <p>好了，现在我们来看看钟爱一等公民的原因是什么。前面 <code>getServerStuff</code> 和 <code>BlogController</code> 两个例子你也都看到了，虽说添加一些没有实际用处的间接层实现起来很容易，但这样做除了徒增代码量，提高维护和检索代码的成本外，没有任何用处。</p> <p>另外，如果一个函数被不必要地包裹起来了，而且发生了改动，那么包裹它的那个函数也要做相应的变更。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">httpGet</span><span class="token punctuation">(</span><span class="token string">'/post/2'</span><span class="token punctuation">,</span> <span class="token parameter">json</span> <span class="token operator">=&gt;</span> <span class="token function">renderPost</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果 <code>httpGet</code> 要改成可以抛出一个可能出现的 <code>err</code> 异常，那我们还要回过头去把“胶水”函数也改了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 把整个应用里的所有 httpGet 调用都改成这样，可以传递 err 参数。</span>
<span class="token function">httpGet</span><span class="token punctuation">(</span><span class="token string">'/post/2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">json<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">renderPost</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>写成一等公民函数的形式，要做的改动将会少得多：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">httpGet</span><span class="token punctuation">(</span><span class="token string">'/post/2'</span><span class="token punctuation">,</span> renderPost<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// renderPost 将会在 httpGet 中调用，想要多少参数都行</span>
</code></pre></div><p>除了删除不必要的函数，正确地为参数命名也必不可少。当然命名不是什么大问题，但还是有可能存在一些不当的命名，尤其随着代码量的增长以及需求的变更，这种可能性也会增加。</p> <p>项目中常见的一种造成混淆的原因是，针对同一个概念使用不同的命名。还有通用代码的问题。比如，下面这两个函数做的事情一模一样，但后一个就显得更加通用，可重用性也更高：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 只针对当前的博客</span>
<span class="token keyword">const</span> <span class="token function-variable function">validArticles</span> <span class="token operator">=</span> <span class="token parameter">articles</span> <span class="token operator">=&gt;</span>
  articles<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">article</span> <span class="token operator">=&gt;</span> article <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> article <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token comment">// 对未来的项目更友好</span>
<span class="token keyword">const</span> <span class="token function-variable function">compact</span> <span class="token operator">=</span> <span class="token parameter">xs</span> <span class="token operator">=&gt;</span> xs<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在命名的时候，我们特别容易把自己限定在特定的数据上（本例中是 <code>articles</code>）。这种现象很常见，也是重复造轮子的一大原因。</p> <p>有一点我必须得指出，你一定要非常小心 <code>this</code> 值，别让它反咬你一口，这一点与面向对象代码类似。如果一个底层函数使用了 <code>this</code>，而且是以一等公民的方式被调用的，那你就等着 JS 这个蹩脚的抽象概念发怒吧。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 太可怕了</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'freaky_friday.txt'</span><span class="token punctuation">,</span> Db<span class="token punctuation">.</span>save<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 好一点点</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'freaky_friday.txt'</span><span class="token punctuation">,</span> Db<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>Db<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>把 Db 绑定（bind）到它自己身上以后，你就可以随心所欲地调用它的原型链式垃圾代码了。<code>this</code> 就像一块脏尿布，我尽可能地避免使用它，因为在函数式编程中根本用不到它。然而，在使用其他的类库时，你却不得不向这个疯狂的世界低头。</p> <p>也有人反驳说 <code>this</code> 能提高执行速度。如果你是这种对速度吹毛求疵的人，那你还是合上这本书吧。要是没法退货退款，也许你可以去换一本更入门的书来读。</p> <p>至此，我们才准备好继续后面的章节。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mostly-adequate-guide-chinese/ch1.html" class="prev">
        第 1 章：我们在做什么？
      </a></span> <span class="next"><a href="/mostly-adequate-guide-chinese/ch3.html">
        第 3 章：纯函数的好处
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mostly-adequate-guide-chinese/assets/js/app.e22f068f.js" defer></script><script src="/mostly-adequate-guide-chinese/assets/js/2.35b03a7f.js" defer></script><script src="/mostly-adequate-guide-chinese/assets/js/17.15cbb2bc.js" defer></script>
  </body>
</html>
